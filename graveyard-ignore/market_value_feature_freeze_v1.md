# Market Value Model v1.0 — Feature Freeze

**Document Version:** 1.0  
**Date:** 2024-12-14  
**Status:** LOCKED  

---

## 1. Scope

| Attribute | Value |
|-----------|-------|
| Market | Australian Yearling Sales |
| Years | 2020–2025 |
| Entity | 1 row = 1 yearling lot |
| Source Table | `mv_yearling_lot_features_v1` |
| Row Count | 34,988 |
| Excludes | Withdrawn lots |

---

## 2. Target Variable

| Field | Definition |
|-------|------------|
| `log_price_index` | `LOG(hammer_price / session_median_price)` |

- **Training/Evaluation only** — not available at inference time
- Session median = sale-level P50 of sold prices
- Distribution: Mean ≈ 0, StdDev ≈ 1.0, Range [-4.9, +4.1]

---

## 3. Feature Groups

### 3.1 Sale Context
| Feature | Type | Description |
|---------|------|-------------|
| `session_median_price` | DECIMAL | Sale-level median hammer price |
| `sale_company` | VARCHAR | Inglis / Magic Millions |
| `sale_name` | VARCHAR | Full sale name |
| `sale_year` | INT | Year of sale |
| `book_number` | INT | Book within sale (nullable) |
| `day_number` | INT | Day within sale (nullable) |
| `sex` | VARCHAR | Colt / Filly / etc |

### 3.2 Sire Features (Rolling, Leakage-Safe)
| Feature | Type | Window | Description |
|---------|------|--------|-------------|
| `sire_sold_count_36m` | INT | 36m | Progeny sold prior to sale |
| `sire_total_offered_36m` | INT | 36m | Progeny offered (sold + passed-in) |
| `sire_clearance_rate_36m` | DECIMAL | 36m | % sold |
| `sire_median_price_36m` | DECIMAL | 36m | Median hammer price |
| `sire_sold_count_12m` | INT | 12m | Recent progeny sold |
| `sire_total_offered_12m` | INT | 12m | Recent progeny offered |
| `sire_clearance_rate_12m` | DECIMAL | 12m | Recent % sold |
| `sire_median_price_12m` | DECIMAL | 12m | Recent median price |
| `sire_momentum` | DECIMAL | — | 12m median − 36m median |
| `sire_sample_flag_36m` | BIT | — | 1 if sold_count < 10 |

### 3.3 Dam Features (All History, Leakage-Safe)
| Feature | Type | Description |
|---------|------|-------------|
| `dam_progeny_sold_count` | INT | Prior progeny sold as yearlings |
| `dam_progeny_total_offered_count` | INT | Prior progeny offered |
| `dam_progeny_median_price` | DECIMAL | Median of prior progeny sales |
| `dam_first_foal_flag` | BIT | 1 if no prior yearling sales |

### 3.4 Vendor Features (Rolling 36m)
| Feature | Type | Description |
|---------|------|-------------|
| `vendor_sold_count_36m` | INT | Lots sold in prior 36m |
| `vendor_total_offered_36m` | INT | Lots offered in prior 36m |
| `vendor_clearance_rate_36m` | DECIMAL | % sold |
| `vendor_median_price_36m` | DECIMAL | Median hammer price |
| `vendor_volume_bucket` | VARCHAR | new (0) / low (1-9) / mid (10-49) / high (50+) |
| `vendor_first_seen_flag` | BIT | 1 if no prior 36m history |

### 3.5 Derived Features (Explainability)
| Feature | Type | Description |
|---------|------|-------------|
| `sire_vs_sale_median_delta` | DECIMAL | Sire median − session median |
| `dam_vs_sale_median_delta` | DECIMAL | Dam median − session median |
| `vendor_vs_sale_median_delta` | DECIMAL | Vendor median − session median |

---

## 4. Explicit Exclusions

The following data sources are **intentionally excluded** from v1.0:

| Exclusion | Rationale |
|-----------|-----------|
| Race results / earnings | Post-sale outcome (leakage risk) |
| Dosage / pedigree theory | Requires separate validation |
| Physical conformation | Not available in structured data |
| Veterinary assessments | Not available in structured data |
| Buyer identity / behavior | Post-sale (leakage risk) |
| Non-AU yearling sales | Out of scope |

This makes the model **commercially defensible** and **reproducible**.

---

## 5. Feature Coverage

| Feature Group | Coverage | Notes |
|---------------|----------|-------|
| Sire median (36m) | 95.5% | 4.5% thin sample (flagged) |
| Dam median | 64.1% | 35.9% first foal (flagged) |
| Vendor median (36m) | 91.9% | 8.1% new vendors (flagged) |

Fallback strategy for NULLs: Use session median as anchor.

---

## 6. Leakage Prevention

All rolling features enforce **strict temporal cutoff**:

```
saleDate < asOfDate
```

- `asOfDate` = sale start date
- No same-sale contamination
- No future information

---

## 7. Versioning

| Attribute | Value |
|-----------|-------|
| Table | `mv_yearling_lot_features_v1` |
| Feature Contract | `v1.0` |
| Generated By | `proc_BuildMvYearlingFeaturesV1` |

**Change Policy:**
- Any feature addition/removal requires new table (`_v2`)
- Any definition change requires new freeze document
- Backward compatibility not guaranteed across versions

---

## 8. Next Steps

1. **Model Spec** — Define model family, loss, validation strategy
2. **Baseline Model** — Elastic Net for sanity check
3. **Production Model** — Quantile GBDT (P25/P50/P75)
4. **Output Integration** — Populate `tblHorseAnalytics`

---

*Document locked. Changes require version increment.*
